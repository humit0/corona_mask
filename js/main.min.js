!function(){function e(e){var t=(e=e.split(" "))[0].split("/"),n=e[1].split(":");return t[1]+"월 "+t[2]+"일 "+n[0]+"시 "+n[1]+"분"}var t,n=document.getElementById("can_buy"),a=(new Date).getDay();t=1<=a&&a<=5?"XXX"+a+"년생, XXX"+(a+5)%10+"년생":"모두",n.innerText="구매 가능: "+t;var s=500,o=new naver.maps.LatLng(37.4501089,126.9528387),i=new naver.maps.Map("map",{center:o,zoom:15}),r=new naver.maps.Circle({map:i,center:o,radius:s,strokeColor:"#3cc79e",strokeOpacity:.7,storkeWeight:1,fillColor:"#fff498",fillOpacity:.5}),l=new XMLHttpRequest,c=[];let p;function m(e,t){var n=e._lat,a=e._lng;c.map(function(e){e[0].setMap(null),e[1].setMap(null)}),p=t?"https://8oi9s0nnth.apigw.ntruss.com/corona19-masks/v2/storesByGeo/json?lat="+n+"&lng="+a+"&m="+s:"https://8oi9s0nnth.apigw.ntruss.com/corona19-masks/v1/storesByGeo/json?lat="+n+"&lng="+a+"&m="+s,l.open("GET",p),l.send(),r.setCenter(e)}l.onreadystatechange=function(){if(l.readyState===XMLHttpRequest.DONE)if(200===l.status){var t={plenty:'<img src="img/plenty.png">',some:'<img src="img/some.png">',few:'<img src="img/few.png">',empty:'<img src="img/empty.png">'},n={plenty:"100-",some:"30-100",few:"1-30",empty:"0"};c=JSON.parse(l.responseText).stores.map(function(a){a.remain_stat=a.remain_stat||"empty";var s=new naver.maps.Marker({position:new naver.maps.LatLng(a.lat,a.lng),map:i,icon:{content:t[a.remain_stat],size:{width:30,height:30}}}),o=['<div class="info_box '+a.remain_stat+'">',"  <h3>"+a.name+"</h3>",'  <p class="addr">'+a.addr+"</p>",'  <p>재고: <span class="stock_status">'+n[a.remain_stat]+"</p>",a.stock_at?"  <p>입고시간: "+e(a.stock_at)+"</p>":"",a.created_at?"<p>업데이트: "+e(a.created_at)+"</p>":"","</div>"].join("");console.log(o);var r=new naver.maps.InfoWindow({content:o,maxWidth:280,pixelOffset:new naver.maps.Point(0,-20),disableAutoPan:!0});return naver.maps.Event.addListener(s,"click",function(e){r.getMap()?r.close():r.open(i,s)}),[s,r]})}else p.includes("/v1/")?m(i.getCenter(),!0):alert("불러오기 실패")},document.getElementById("agree_btn").addEventListener("click",function(){!function(e,t,n){var a=new Date;a.setTime(a.getTime()+24*n*60*60*1e3);var s="expires="+a.toUTCString();document.cookie=e+"="+t+";"+s+";path=/"}("agree","1"),document.getElementById("disable_area").style.display="none",document.getElementById("agreement").style.display="none"}),window.addEventListener("load",function(){"1"!==function(e){for(var t=e+"=",n=decodeURIComponent(document.cookie).split(";"),a=0;a<n.length;a++){for(var s=n[a];" "==s.charAt(0);)s=s.substring(1);if(0==s.indexOf(t))return s.substring(t.length,s.length)}return""}("agree")&&(document.getElementById("disable_area").style.display="block",document.getElementById("agreement").style.display="block");var e=['<div class="dist_ctl">','<input type="button" class="btn" val="200" value="200m">','<input type="button" class="btn" val="500" value="500m">','<input type="button" class="btn" val="1000" value="1km">',"</div>"].join(""),t=new naver.maps.CustomControl(e,{position:naver.maps.Position.BOTTOM_CENTER});t.setMap(i);var n=t.getElement().firstChild.children;Array.prototype.slice.call(n).map(function(e){naver.maps.Event.addDOMListener(e,"click",function(){var t=e.getAttribute("val");s=parseInt(t),r.setRadius(s),m(i.getCenter())})}),naver.maps.Event.addListener(i,"center_changed",_.debounce(m,100)),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){o=new naver.maps.LatLng(e.coords.latitude,e.coords.longitude),i.setCenter(o)},function(){console.log("failed to get location"),m(o)}):m(o)})}();